---
import themes from "../styles/themes.json";
---

<script define:vars={{ themes }}>
  function findThemeDefinition(item) {
    return themes.find((t) => t.name === item);
  }

  const item = window.localStorage.getItem("theme");
  const themeDefinition = findThemeDefinition(item);

  if (item && !themeDefinition) {
    window.localStorage.setItem("theme", "default");
    console.log("Theme not found, setting to default");
  }

  const themeValue = themeDefinition || findThemeDefinition("default");
  let theme;

  switch (window.localStorage.getItem("brightness")) {
    case "dark":
      theme = themeValue.dark;
      break;
    case "light":
      theme = themeValue.light;
      break;
    case "auto":
      theme = window.matchMedia("(prefers-color-scheme: dark)").matches
        ? themeValue.dark
        : themeValue.light;
      break;
  }

  switchTheme(theme);

  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", (e) => {
      const tv = e.matches ? themeValue.dark : themeValue.light;

      switchTheme(tv);
    });

  function switchTheme(theme) {
    document.documentElement.style.setProperty(
      "--primary-color",
      theme.primary
    );
    document.documentElement.style.setProperty(
      "--secondary-color",
      theme.secondary
    );
    document.documentElement.style.setProperty(
      "--background-color",
      theme.background
    );
    document.documentElement.style.setProperty(
      "--tertiary-color",
      theme.tertiary
    );
  }
</script>
