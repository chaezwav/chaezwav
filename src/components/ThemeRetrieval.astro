---
import themes from "../styles/themes.json";
---

<script define:vars={{ themes }}>
  function findThemeDefinition(item) {
    return themes.find((t) => t.name === item);
  }

  const item = window.localStorage.getItem("theme");
  const themeDefinition = findThemeDefinition(item);

  if (item && !themeDefinition) {
    window.localStorage.setItem("theme", "default");
    console.log("issue: style: theme not found, set to default");
  }

  const themeValue = themeDefinition || findThemeDefinition("default");
  let theme = window.matchMedia("(prefers-color-scheme: dark)").matches
    ? themeValue.dark
    : themeValue.light;

  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", (e) => {
      theme = e.matches ? themeValue.dark : themeValue.light;
      switchTheme(theme);
    });

  function switchTheme(theme) {
    document.documentElement.style.setProperty(
      "--primary-color",
      theme.primary
    );
    document.documentElement.style.setProperty(
      "--secondary-color",
      theme.secondary
    );
    document.documentElement.style.setProperty(
      "--background-color",
      theme.background
    );
    document.documentElement.style.setProperty(
      "--tertiary-color",
      theme.tertiary
    );

    document
      .querySelector("meta[name=theme-color]")
      .setAttribute("content", theme.background);
  }

  switchTheme(theme);
</script>
